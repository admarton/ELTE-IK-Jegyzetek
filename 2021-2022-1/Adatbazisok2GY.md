# Adatbázisok 2 GY 2021.09.09

https://people.inf.elte.hu/branyi/ora/gyak2/  
https://branyi.hu

## Jegy
- 2 * 2 * 45 prec (papíros, gépes)
- 4 jegy átlaga
- mind min 2
- 8 alkalom javítás - egy alkalom 2 zh-t lehet javítani
- javításnál csonkolás van, nem kerekítés

## Tananyag
1. ZH 
    - Papíros
        - B+ fa rajzolás, nem az mint a sima B+ fa
        - Lineáris hasító index
        - ...
    - Gépes
        - Rendszergazdai dolgok
        - Rendszertáblák
2. ZH
    - Papíros
        - Naplózás
        - Megelőzési gráf
        - Költségszámítás
    - Gépes
        - Mit csinál a gép
        - Hintek

# Nevezés
- Oracle nagybetűsít
- LiteSQl nem foglalkozik ilyesmive
- x név ≠ "x" név


```SQL

SELECT * 
FROM DBA_OBJECTS;

SELECT * 
FROM ALL_OBJECTS;

SELECT * 
FROM USER_OBJECTS;

CREATE TABLE X(A NUMBER);

SELECT * 
FROM DBA_OBJECTS
WHERE OBJECT_NAME='X'
ORDER BY 9 ASC;

CREATE TABLE "x"(A NUMBER);

-- 1.
SELECT OWNER TULAJDONOS
FROM DBA_OBJECTS 
WHERE OBJECT_NAME='DBA_TABLES' AND OBJECT_TYPE='VIEW';


SELECT 1+1 FROM x;
-- SEMMI

SELECT 1+1 FROM DUAL;
-- 2

SELECT 1+1 FROM DOLGOZO; -- NEM ÜRES TÁBLA
-- 2 ANNYISZOR AHÁNY SOR VAN


```

- DUAL EGY SIMA EGY CELLÁS TÁBLA, MERT ORACLE-BAN MINDEN LEKÉRDEZÉSHEZ KELL EGY TÁBLA
- HA VAN OLYAN NEVŰ OBJ, AKKOR AZT HASZNÁLJA; HA NINCS, AKKOR A PUBLIC-OT HASZNÁLJA
- HA SZINONÍMA VAN, AKKOR ARRA HIVATKOZIK

# GYAK 2021.09.16

```SQL
SELECT DISTINCT OBJECT_TYPE "object_type" FROM DBA_OBJECTS WHERE OWNER="ORAUSER";

-- MILYEN TÍPUSU OBJ-K VANNAK A DB-BEN
SELECT DISTINCT OBJECT_TYPE FROM DBA_OBJECTS;

-- HÁNY OBJ TÍPUS VAN A DB-BEN
SELECT COUNT(DISTINCT OBJECT_TYPE) "darab" FROM DBA_OBJECTS;
-- 47

-- KINEK VAN TÖBB MINT 10 FÉLE
SELECT OWNER, COUNT(DISTINCT OBJECT_TYPE) FROM DBA_OBJECTS GROUP BY OWNER HAVING COUNT(DISTINCT OBJECT_TYPE) > 10;
-- SYS CSAK 44

-- KINEK VAN NÉZETE ÉS TRIGGERE
SELECT DISTINCT OWNER FROM DBA_OBJECTS WHERE OBJECT_TYPE = "VIEW"
INTERSECT
SELECT DISTINCT OWNER FROM DBA_OBJECTS WHERE OBJECT_TYPE = "TRIGGER";

-- MIN 40 TABLE, MAX 37 INDEX
SELECT DISTINCT OWNER FROM DBA_OBJECTS WHERE OBJECT_TYPE="TABLE" GROUP BY OWNER HAVING COUNT(*)>40
INTERSECT
(SELECT DISTINCT OWNER FROM DBA_OBJECTS WHERE OBJECT_TYPE="INDEX" GROUP BY OWNER HAVING COUNT(*)<37
UNION
(SELECT USERNAME FROM DBA_USERS
MINUS
SELECT OWNER FROM DBA_OBJECTS WHERE OBJECT_TYPE="INDEX"));

SELECT DISTINCT OWNER FROM DBA_OBJECTS WHERE OBJECT_TYPE="TABLE" GROUP BY OWNER HAVING COUNT(*)>40
MINUS
SELECT DISTINCT OWNER FROM DBA_OBJECTS WHERE OBJECT_TYPE="INDEX" GROUP BY OWNER HAVING COUNT(*)>37;
```

- DBA_TABLE táblákat mutat
- all_tables, user_tables

# GYAK 3 2021.09.23

```sql
-- Oszlopok tulajdonságai
select * from dba_tab_columns;

-- Fordító eszköz - megadja az oszlopokat és a típúsaikat, meg hogy lehet-e null
desc dual;
```

- Ha olyan típust ad meg az ember ami nincs de ansi-ban van, akkor azt is feldolgozza
    - smallint  -> number, 0 tizedes jegy
    - int       -> number, 0 tizedes jegy
    - float     -> float, 126 jegy
    - real      -> float, 63 jegy
    - varchar   -> varchar2
- Típusok
    - char      -> kitölti a maradékot szóközzel a fix hosszhoz (trim, ltrim, rtrim)
    - varchar2  -> max hosszt lehet megadni, nem tölti ki szóközzel
    - nchar     -> kétszer annyi hosszt felvett mint amennyit megadná

```sql
-- Tábla tulajdonos és nevÉT AMINEK VAN Z-VEL KEZDŐDIK NEVŰ OSZLOPA
SELECT DISTINCT OWNER, TABLE_NAME FROM DBA_TAB_COLUMNS WHERE COLUMN_NAME LIKE 'Z%';
SELECT DISTINCT OWNER, TABLE_NAME FROM DBA_TAB_COLUMNS WHERE SUBSTR(COLUMN_NAME,1,1) = 'Z';
SELECT DISTINCT OWNER, TABLE_NAME FROM DBA_TAB_COLUMNS WHERE INSTR(COLUMN_NAME, 'Z') = 1; -- JÖVŐHÉTEN EZZEL LEHET MEGOLDANI EGY FELADATOT

-- TÁBLÁK AMIBEN MIN 8 DÁTUM TÍPUSÚ CUCC VAN
SELECT OWNER, TABLE_NAME FROM DBA_TAB_COLUMNS 
WHERE DATA_TYPE="DATE" 
GROUP BY OWNER, TABLE_NAME
HAVING COUNT(TABLE_NAME) >= 8;

-- TÁBLA AMIBEN  AZ ELSŐ OSZLOP VARCHAR2
SELECT DISTINCT TABLE_NAME FROM DBA_TAB_COLUMNS
WHERE DATA_TYPE = 'VARCHAR2' AND COLUMN_ID=1;

-- TÁBLA AMIBEN  A NEGYEDIK OSZLOP VARCHAR2
SELECT DISTINCT TABLE_NAME FROM DBA_TAB_COLUMNS
WHERE DATA_TYPE = 'VARCHAR2' AND COLUMN_ID=4;

-- TÁBLA AMIBEN  AZ ELSŐ ÉS NEGYEDIK OSZLOP VARCHAR2
SELECT DISTINCT TABLE_NAME FROM
(SELECT DISTINCT OWNER, TABLE_NAME FROM DBA_TAB_COLUMNS
WHERE DATA_TYPE = 'VARCHAR2' AND COLUMN_ID=1
INTERSECT
SELECT DISTINCT OWNER, TABLE_NAME FROM DBA_TAB_COLUMNS
WHERE DATA_TYPE = 'VARCHAR2' AND COLUMN_ID=4);

-- SZEKVENCIA VÁLTOZÓ
CREATE SEQUENCE NAME 
START WITH 1
NOCYCLE;
-- .CURVAL, .NEXTVAL
-- EGYEDI AZON KIOSZTÁSA
```

### Kövi óra
- Mindkét adatbázisba be fogunk lépni
- Nézettábla

# Gyak 4 2021.09.30

## Csatlakozás adatbázishoz
```sql
CREATE DATABASE LINK aramis_link CONNECT TO felhasználónév IDENTIFIED BY jelszo
USING 'aramis.inf.elte.hu:1521/aramis';

SELECT * FROM USER_DB_LINK;
SELECT * FROM DBA_DB_LINK;

SELECT * FROM SZERET;
SELECT * FROM SZERET@aramis_link;

CREATE OR REPLACE SYNONYM ORSZAGOK FOR NIKOVITS.VILAG_ORSZAGAI; 
CREATE OR REPLACE SYNONYM FOLYOK FOR NIKOVITS.FOLYOK; 

SELECT TLD,NEV
FROM ORSZAGOK
WHERE (
    SELECT ORSZAGOK 
    FROM FOLYOK
    WHERE NEV=''
) ...;

SELECT * FROM DBA_VIEWS;
CREATE VIEW NÉV AS ALLEKÉRDEZÉS;
```
- LEHET ADATOT BEVINNIN A NÉZETTÁBLÁBA?
    - LEHET, DE NEM MINDEGYIKBE
    - AZ ADAT AZ EREDETI TÁBLÁBA KERÜL

- MIT RAK AZ ÜRES HELYEKRE,
    - HA NINCS SEMMI AKKOR NULL
    - HA VAN DEFAULT AKKOR AZ
    - HA MEG VAN ADVA AZ INSERT-NÉL AKKKOR AZ

- BE LEHET-E RAKNI SELECTES VIEW-BA
    - A TÁBLÁBA RAKJA

- MUNKÁS TÁBLÁBA SZÚRÁS
    - HA NINCS DEFAULT ÉS NOT NULL AKKOR NEM ENGEDI A NEMMEGHATÁROZOTT BESZÚRÁST
    - MEGSZORÍTÁSOK - CONSTRAINT
        - GÁTOLHAT BESZÚRÁST

- DISTINCT VIEW-BA NEM LEHET BESZÚRNI
- GROUP BY-OS VIEW-BA SEM LEHET BESZÚRNI
- ÖSSZEKAPCSOLÁSOS VIEW-BA SEM LEHET
- EREDMÉNY OSZLOPOT TARTALMAZÓ VIEW-BA SE LEHET

- CSAK LEÍRÁST TARTALMAZ

